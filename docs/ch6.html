<!DOCTYPE html>
<html >

<head>

  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <title>Introduction to R for Natural Resource Scientists</title>
  <meta name="description" content="This is a first course in R programming for natural resource scientists. It was developed and has been primarily instructed at Auburn University.">
  <meta name="generator" content="bookdown 0.7 and GitBook 2.6.7">

  <meta property="og:title" content="Introduction to R for Natural Resource Scientists" />
  <meta property="og:type" content="book" />
  
  
  <meta property="og:description" content="This is a first course in R programming for natural resource scientists. It was developed and has been primarily instructed at Auburn University." />
  <meta name="github-repo" content="bstaton1/au-r-workshop" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Introduction to R for Natural Resource Scientists" />
  
  <meta name="twitter:description" content="This is a first course in R programming for natural resource scientists. It was developed and has been primarily instructed at Auburn University." />
  

<meta name="author" content="Ben Staton">



  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black">
  
  
<link rel="prev" href="ch5.html">
<link rel="next" href="exercise-solutions.html">
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />









<style type="text/css">
div.sourceCode { overflow-x: auto; }
table.sourceCode, tr.sourceCode, td.lineNumbers, td.sourceCode {
  margin: 0; padding: 0; vertical-align: baseline; border: none; }
table.sourceCode { width: 100%; line-height: 100%; }
td.lineNumbers { text-align: right; padding-right: 4px; padding-left: 4px; color: #aaaaaa; border-right: 1px solid #aaaaaa; }
td.sourceCode { padding-left: 5px; }
code > span.kw { color: #007020; font-weight: bold; } /* Keyword */
code > span.dt { color: #902000; } /* DataType */
code > span.dv { color: #40a070; } /* DecVal */
code > span.bn { color: #40a070; } /* BaseN */
code > span.fl { color: #40a070; } /* Float */
code > span.ch { color: #4070a0; } /* Char */
code > span.st { color: #4070a0; } /* String */
code > span.co { color: #60a0b0; font-style: italic; } /* Comment */
code > span.ot { color: #007020; } /* Other */
code > span.al { color: #ff0000; font-weight: bold; } /* Alert */
code > span.fu { color: #06287e; } /* Function */
code > span.er { color: #ff0000; font-weight: bold; } /* Error */
code > span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
code > span.cn { color: #880000; } /* Constant */
code > span.sc { color: #4070a0; } /* SpecialChar */
code > span.vs { color: #4070a0; } /* VerbatimString */
code > span.ss { color: #bb6688; } /* SpecialString */
code > span.im { } /* Import */
code > span.va { color: #19177c; } /* Variable */
code > span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code > span.op { color: #666666; } /* Operator */
code > span.bu { } /* BuiltIn */
code > span.ex { } /* Extension */
code > span.pp { color: #bc7a00; } /* Preprocessor */
code > span.at { color: #7d9029; } /* Attribute */
code > span.do { color: #ba2121; font-style: italic; } /* Documentation */
code > span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code > span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code > span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">Intro to R for Nat. Res. Sci.</a></li>

<li class="divider"></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Overview</a><ul>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#what-is-covered"><i class="fa fa-check"></i>What is Covered?</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#prerequisites"><i class="fa fa-check"></i>Prerequisites</a><ul>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#comp-prep"><i class="fa fa-check"></i>Prepare Your Computer</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#data-sets"><i class="fa fa-check"></i>Data Sets</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#exercises"><i class="fa fa-check"></i>Exercises</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#notation"><i class="fa fa-check"></i>Text Conventions</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#keyboard-shortcuts"><i class="fa fa-check"></i>Keyboard Shortcuts</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#development-of-this-book"><i class="fa fa-check"></i>Development of this Book</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#about-the-author"><i class="fa fa-check"></i>About the Author</a></li>
</ul></li>
<li class="chapter" data-level="1" data-path="ch1.html"><a href="ch1.html"><i class="fa fa-check"></i><b>1</b> Introduction to the R Environment</a><ul>
<li class="chapter" data-level="" data-path="ch1.html"><a href="ch1.html#chapter-overview"><i class="fa fa-check"></i>Chapter Overview</a></li>
<li class="chapter" data-level="" data-path="ch1.html"><a href="ch1.html#before-you-begin-install-r-and-rstudio"><i class="fa fa-check"></i>Before You Begin: Install R and RStudio</a></li>
<li class="chapter" data-level="1.1" data-path="ch1.html"><a href="ch1.html#the-r-studio-interface"><i class="fa fa-check"></i><b>1.1</b> The R Studio Interface</a><ul>
<li class="chapter" data-level="1.1.1" data-path="ch1.html"><a href="ch1.html#write-some-simple-code"><i class="fa fa-check"></i><b>1.1.1</b> Write Some Simple Code</a></li>
</ul></li>
<li class="chapter" data-level="1.2" data-path="ch1.html"><a href="ch1.html#scripts"><i class="fa fa-check"></i><b>1.2</b> Saving Your Code: Scripts</a></li>
<li class="chapter" data-level="1.3" data-path="ch1.html"><a href="ch1.html#working-dir"><i class="fa fa-check"></i><b>1.3</b> The Working Directory</a></li>
<li class="chapter" data-level="1.4" data-path="ch1.html"><a href="ch1.html#r-object-types"><i class="fa fa-check"></i><b>1.4</b> R Object Types</a><ul>
<li class="chapter" data-level="1.4.1" data-path="ch1.html"><a href="ch1.html#functions"><i class="fa fa-check"></i><b>1.4.1</b> Functions</a></li>
<li class="chapter" data-level="1.4.2" data-path="ch1.html"><a href="ch1.html#vectors"><i class="fa fa-check"></i><b>1.4.2</b> Vectors</a></li>
<li class="chapter" data-level="1.4.3" data-path="ch1.html"><a href="ch1.html#matrices"><i class="fa fa-check"></i><b>1.4.3</b> Matrices</a></li>
<li class="chapter" data-level="1.4.4" data-path="ch1.html"><a href="ch1.html#data-frames"><i class="fa fa-check"></i><b>1.4.4</b> Data Frames</a></li>
</ul></li>
<li class="chapter" data-level="1.5" data-path="ch1.html"><a href="ch1.html#factors"><i class="fa fa-check"></i><b>1.5</b> Factors</a></li>
<li class="chapter" data-level="1.6" data-path="ch1.html"><a href="ch1.html#vector-math"><i class="fa fa-check"></i><b>1.6</b> Vector Math</a></li>
<li class="chapter" data-level="1.7" data-path="ch1.html"><a href="ch1.html#sub"><i class="fa fa-check"></i><b>1.7</b> Data Subsets/Queries</a></li>
<li class="chapter" data-level="" data-path="ch1.html"><a href="ch1.html#exercise-1a"><i class="fa fa-check"></i>Exercise 1A</a></li>
<li class="chapter" data-level="1.8" data-path="ch1.html"><a href="ch1.html#read"><i class="fa fa-check"></i><b>1.8</b> Read External Data Files</a></li>
<li class="chapter" data-level="1.9" data-path="ch1.html"><a href="ch1.html#data-summaries"><i class="fa fa-check"></i><b>1.9</b> Explore the Data Set</a></li>
<li class="chapter" data-level="1.10" data-path="ch1.html"><a href="ch1.html#logicalboolean-operators"><i class="fa fa-check"></i><b>1.10</b> Logical/Boolean Operators</a></li>
<li class="chapter" data-level="1.11" data-path="ch1.html"><a href="ch1.html#logsub"><i class="fa fa-check"></i><b>1.11</b> Logical Subsetting</a></li>
<li class="chapter" data-level="1.12" data-path="ch1.html"><a href="ch1.html#if-else-and-ifelse"><i class="fa fa-check"></i><b>1.12</b> <code>if()</code>, <code>else</code>, and <code>ifelse()</code></a></li>
<li class="chapter" data-level="1.13" data-path="ch1.html"><a href="ch1.html#writing-output-files"><i class="fa fa-check"></i><b>1.13</b> Writing Output Files</a><ul>
<li class="chapter" data-level="1.13.1" data-path="ch1.html"><a href="ch1.html#csv-files"><i class="fa fa-check"></i><b>1.13.1</b> <code>.csv</code> Files</a></li>
<li class="chapter" data-level="1.13.2" data-path="ch1.html"><a href="ch1.html#saving-r-objects"><i class="fa fa-check"></i><b>1.13.2</b> Saving R Objects</a></li>
</ul></li>
<li class="chapter" data-level="1.14" data-path="ch1.html"><a href="ch1.html#user-funcs"><i class="fa fa-check"></i><b>1.14</b> User-Defined Functions</a></li>
<li class="chapter" data-level="" data-path="ch1.html"><a href="ch1.html#ex1b"><i class="fa fa-check"></i>Exercise 1B</a><ul>
<li class="chapter" data-level="" data-path="ch1.html"><a href="ch1.html#exercise-1b-bonus"><i class="fa fa-check"></i>Exercise 1B Bonus</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="2" data-path="ch2.html"><a href="ch2.html"><i class="fa fa-check"></i><b>2</b> Base R Plotting Basics</a><ul>
<li class="chapter" data-level="" data-path="ch2.html"><a href="ch2.html#chapter-overview-1"><i class="fa fa-check"></i>Chapter Overview</a></li>
<li class="chapter" data-level="" data-path="ch2.html"><a href="ch2.html#before-you-begin"><i class="fa fa-check"></i>Before You Begin</a></li>
<li class="chapter" data-level="2.1" data-path="ch2.html"><a href="ch2.html#r-plotting-lingo"><i class="fa fa-check"></i><b>2.1</b> R Plotting Lingo</a></li>
<li class="chapter" data-level="2.2" data-path="ch2.html"><a href="ch2.html#lower-level-plotting-functions"><i class="fa fa-check"></i><b>2.2</b> Lower Level Plotting Functions</a></li>
<li class="chapter" data-level="2.3" data-path="ch2.html"><a href="ch2.html#other-high-level-plotting-functions"><i class="fa fa-check"></i><b>2.3</b> Other High-Level Plotting Functions</a><ul>
<li class="chapter" data-level="2.3.1" data-path="ch2.html"><a href="ch2.html#the-bar-graph"><i class="fa fa-check"></i><b>2.3.1</b> The Bar Graph</a></li>
</ul></li>
<li class="chapter" data-level="2.4" data-path="ch2.html"><a href="ch2.html#box-whisker"><i class="fa fa-check"></i><b>2.4</b> Box-and-Whisker Plots</a></li>
<li class="chapter" data-level="2.5" data-path="ch2.html"><a href="ch2.html#histograms"><i class="fa fa-check"></i><b>2.5</b> Histograms</a></li>
<li class="chapter" data-level="2.6" data-path="ch2.html"><a href="ch2.html#the-par-function"><i class="fa fa-check"></i><b>2.6</b> The <code>par</code> Function</a></li>
<li class="chapter" data-level="2.7" data-path="ch2.html"><a href="ch2.html#new-temporary-devices"><i class="fa fa-check"></i><b>2.7</b> New Temporary Devices</a></li>
<li class="chapter" data-level="2.8" data-path="ch2.html"><a href="ch2.html#multi-panel-plots"><i class="fa fa-check"></i><b>2.8</b> Multi-panel Plots</a></li>
<li class="chapter" data-level="2.9" data-path="ch2.html"><a href="ch2.html#legends"><i class="fa fa-check"></i><b>2.9</b> Legends</a></li>
<li class="chapter" data-level="2.10" data-path="ch2.html"><a href="ch2.html#exporting-plots"><i class="fa fa-check"></i><b>2.10</b> Exporting Plots</a><ul>
<li class="chapter" data-level="2.10.1" data-path="ch2.html"><a href="ch2.html#click-save"><i class="fa fa-check"></i><b>2.10.1</b> Click Save</a></li>
<li class="chapter" data-level="2.10.2" data-path="ch2.html"><a href="ch2.html#file-devices"><i class="fa fa-check"></i><b>2.10.2</b> Use a function to place plot in a new file</a></li>
</ul></li>
<li class="chapter" data-level="2.11" data-path="ch2.html"><a href="ch2.html#error-bars"><i class="fa fa-check"></i><b>2.11</b> Bonus Topic: Error Bars</a></li>
<li class="chapter" data-level="" data-path="ch2.html"><a href="ch2.html#ex2"><i class="fa fa-check"></i>Exercise 2</a><ul>
<li class="chapter" data-level="" data-path="ch2.html"><a href="ch2.html#exercise-2-bonus"><i class="fa fa-check"></i>EXERCISE 2 BONUS</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="3" data-path="ch3.html"><a href="ch3.html"><i class="fa fa-check"></i><b>3</b> Basic Statistics</a><ul>
<li class="chapter" data-level="" data-path="ch3.html"><a href="ch3.html#chapter-overview-2"><i class="fa fa-check"></i>Chapter Overview</a></li>
<li class="chapter" data-level="" data-path="ch3.html"><a href="ch3.html#before-you-begin-1"><i class="fa fa-check"></i>Before You Begin</a></li>
<li class="chapter" data-level="3.1" data-path="ch3.html"><a href="ch3.html#lm"><i class="fa fa-check"></i><b>3.1</b> The General Linear Model</a><ul>
<li class="chapter" data-level="3.1.1" data-path="ch3.html"><a href="ch3.html#regression"><i class="fa fa-check"></i><b>3.1.1</b> Simple Linear Regression</a></li>
<li class="chapter" data-level="3.1.2" data-path="ch3.html"><a href="ch3.html#anova"><i class="fa fa-check"></i><b>3.1.2</b> ANOVA: Categorical predictors</a></li>
<li class="chapter" data-level="3.1.3" data-path="ch3.html"><a href="ch3.html#ancova-continuous-and-categorical-predictors"><i class="fa fa-check"></i><b>3.1.3</b> ANCOVA: Continuous and categorical predictors</a></li>
<li class="chapter" data-level="3.1.4" data-path="ch3.html"><a href="ch3.html#interactions"><i class="fa fa-check"></i><b>3.1.4</b> Interactions</a></li>
<li class="chapter" data-level="3.1.5" data-path="ch3.html"><a href="ch3.html#aic-model-selection"><i class="fa fa-check"></i><b>3.1.5</b> AIC Model Selection</a></li>
</ul></li>
<li class="chapter" data-level="3.2" data-path="ch3.html"><a href="ch3.html#glms"><i class="fa fa-check"></i><b>3.2</b> The Generalized Linear Model</a><ul>
<li class="chapter" data-level="3.2.1" data-path="ch3.html"><a href="ch3.html#logis-regression"><i class="fa fa-check"></i><b>3.2.1</b> Logistic Regression</a></li>
<li class="chapter" data-level="3.2.2" data-path="ch3.html"><a href="ch3.html#aic-model-selection-1"><i class="fa fa-check"></i><b>3.2.2</b> AIC Model Selection</a></li>
</ul></li>
<li class="chapter" data-level="3.3" data-path="ch3.html"><a href="ch3.html#dists"><i class="fa fa-check"></i><b>3.3</b> Probability Distributions</a></li>
<li class="chapter" data-level="3.4" data-path="ch3.html"><a href="ch3.html#nls"><i class="fa fa-check"></i><b>3.4</b> Bonus Topic: Non-linear Regression</a></li>
<li class="chapter" data-level="" data-path="ch3.html"><a href="ch3.html#exercise-3"><i class="fa fa-check"></i>Exercise 3</a><ul>
<li class="chapter" data-level="" data-path="ch3.html"><a href="ch3.html#exercise-3-bonus"><i class="fa fa-check"></i>Exercise 3 Bonus</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="4" data-path="ch4.html"><a href="ch4.html"><i class="fa fa-check"></i><b>4</b> Monte Carlo Methods</a><ul>
<li class="chapter" data-level="" data-path="ch4.html"><a href="ch4.html#chapter-overview-3"><i class="fa fa-check"></i>Chapter Overview</a></li>
<li class="chapter" data-level="" data-path="ch4.html"><a href="ch4.html#before-you-begin-2"><i class="fa fa-check"></i>Before You Begin</a></li>
<li class="chapter" data-level="" data-path="ch4.html"><a href="ch4.html#layout-of-this-chapter"><i class="fa fa-check"></i>Layout of This Chapter</a></li>
<li class="chapter" data-level="4.1" data-path="ch4.html"><a href="ch4.html#randomness"><i class="fa fa-check"></i><b>4.1</b> Introducing Randomness</a><ul>
<li class="chapter" data-level="4.1.1" data-path="ch4.html"><a href="ch4.html#random-deviates"><i class="fa fa-check"></i><b>4.1.1</b> Random deviates</a></li>
<li class="chapter" data-level="4.1.2" data-path="ch4.html"><a href="ch4.html#resampling"><i class="fa fa-check"></i><b>4.1.2</b> Resampling</a></li>
</ul></li>
<li class="chapter" data-level="4.2" data-path="ch4.html"><a href="ch4.html#reproducing-randomness"><i class="fa fa-check"></i><b>4.2</b> Reproducing Randomness</a></li>
<li class="chapter" data-level="4.3" data-path="ch4.html"><a href="ch4.html#replication"><i class="fa fa-check"></i><b>4.3</b> Replication</a><ul>
<li class="chapter" data-level="4.3.1" data-path="ch4.html"><a href="ch4.html#replicate"><i class="fa fa-check"></i><b>4.3.1</b> <code>replicate()</code></a></li>
<li class="chapter" data-level="4.3.2" data-path="ch4.html"><a href="ch4.html#for-loops"><i class="fa fa-check"></i><b>4.3.2</b> The <code>for()</code> loop</a></li>
</ul></li>
<li class="chapter" data-level="4.4" data-path="ch4.html"><a href="ch4.html#adv-funcs"><i class="fa fa-check"></i><b>4.4</b> Function Writing</a></li>
<li class="chapter" data-level="4.5" data-path="ch4.html"><a href="ch4.html#mc-summaries"><i class="fa fa-check"></i><b>4.5</b> Summarization</a><ul>
<li class="chapter" data-level="4.5.1" data-path="ch4.html"><a href="ch4.html#central-tendency"><i class="fa fa-check"></i><b>4.5.1</b> Central Tendency</a></li>
<li class="chapter" data-level="4.5.2" data-path="ch4.html"><a href="ch4.html#variability"><i class="fa fa-check"></i><b>4.5.2</b> Variability</a></li>
<li class="chapter" data-level="4.5.3" data-path="ch4.html"><a href="ch4.html#frequencies"><i class="fa fa-check"></i><b>4.5.3</b> Frequencies</a></li>
</ul></li>
<li class="chapter" data-level="4.6" data-path="ch4.html"><a href="ch4.html#sim-examples"><i class="fa fa-check"></i><b>4.6</b> Simulation-Based Examples</a><ul>
<li class="chapter" data-level="4.6.1" data-path="ch4.html"><a href="ch4.html#rnorm-ex"><i class="fa fa-check"></i><b>4.6.1</b> Test <code>rnorm</code></a></li>
<li class="chapter" data-level="4.6.2" data-path="ch4.html"><a href="ch4.html#power-ex"><i class="fa fa-check"></i><b>4.6.2</b> Stochastic Power Analysis</a></li>
<li class="chapter" data-level="4.6.3" data-path="ch4.html"><a href="ch4.html#harv-ex"><i class="fa fa-check"></i><b>4.6.3</b> Harvest Policy Analysis</a></li>
</ul></li>
<li class="chapter" data-level="4.7" data-path="ch4.html"><a href="ch4.html#resample-examples"><i class="fa fa-check"></i><b>4.7</b> Resampling-Based Examples</a><ul>
<li class="chapter" data-level="4.7.1" data-path="ch4.html"><a href="ch4.html#boot-test-ex"><i class="fa fa-check"></i><b>4.7.1</b> The Bootstrap</a></li>
<li class="chapter" data-level="4.7.2" data-path="ch4.html"><a href="ch4.html#perm-test-ex"><i class="fa fa-check"></i><b>4.7.2</b> Permutation Test</a></li>
</ul></li>
<li class="chapter" data-level="4.8" data-path="ch4.html"><a href="ch4.html#exercise-4"><i class="fa fa-check"></i><b>4.8</b> Exercise 4</a><ul>
<li class="chapter" data-level="" data-path="ch4.html"><a href="ch4.html#exercise-4a-required-material-only"><i class="fa fa-check"></i>Exercise 4A: Required Material Only</a></li>
<li><a href="ch4.html#exercise-4b-test-rnorm">Exercise 4B: Test <code>rnorm</code></a></li>
<li class="chapter" data-level="" data-path="ch4.html"><a href="ch4.html#exercise-4c-stochastic-power-analysis"><i class="fa fa-check"></i>Exercise 4C: Stochastic Power Analysis</a></li>
<li class="chapter" data-level="" data-path="ch4.html"><a href="ch4.html#exercise-4d-harvest-policy-analysis"><i class="fa fa-check"></i>Exercise 4D: Harvest Policy Analysis</a></li>
<li class="chapter" data-level="" data-path="ch4.html"><a href="ch4.html#exercise-4e-the-bootstrap"><i class="fa fa-check"></i>Exercise 4E: The Bootstrap</a></li>
<li class="chapter" data-level="" data-path="ch4.html"><a href="ch4.html#exercise-4f-permutation-tests"><i class="fa fa-check"></i>Exercise 4F: Permutation Tests</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="5" data-path="ch5.html"><a href="ch5.html"><i class="fa fa-check"></i><b>5</b> Large Data Manipulation</a><ul>
<li class="chapter" data-level="" data-path="ch5.html"><a href="ch5.html#chapter-overview-4"><i class="fa fa-check"></i>Chapter Overview</a></li>
<li class="chapter" data-level="" data-path="ch5.html"><a href="ch5.html#before-you-begin-3"><i class="fa fa-check"></i>Before You Begin</a></li>
<li class="chapter" data-level="5.1" data-path="ch5.html"><a href="ch5.html#aquiring-and-loading-packages"><i class="fa fa-check"></i><b>5.1</b> Aquiring and Loading Packages</a></li>
<li class="chapter" data-level="5.2" data-path="ch5.html"><a href="ch5.html#the-data"><i class="fa fa-check"></i><b>5.2</b> The Data</a></li>
<li class="chapter" data-level="5.3" data-path="ch5.html"><a href="ch5.html#change-format-using-melt"><i class="fa fa-check"></i><b>5.3</b> Change format using <code>melt()</code></a></li>
<li class="chapter" data-level="5.4" data-path="ch5.html"><a href="ch5.html#join-data-sets-with-merge"><i class="fa fa-check"></i><b>5.4</b> Join Data Sets with <code>merge()</code></a></li>
<li class="chapter" data-level="5.5" data-path="ch5.html"><a href="ch5.html#lagged-vectors"><i class="fa fa-check"></i><b>5.5</b> Lagged vectors</a></li>
<li class="chapter" data-level="5.6" data-path="ch5.html"><a href="ch5.html#adding-columns-with-mutate"><i class="fa fa-check"></i><b>5.6</b> Adding columns with <code>mutate()</code></a></li>
<li class="chapter" data-level="5.7" data-path="ch5.html"><a href="ch5.html#apply-to-all-years"><i class="fa fa-check"></i><b>5.7</b> Apply to all years</a></li>
<li class="chapter" data-level="5.8" data-path="ch5.html"><a href="ch5.html#calculate-daily-means-with-summarize"><i class="fa fa-check"></i><b>5.8</b> Calculate Daily Means with <code>summarize()</code></a></li>
<li class="chapter" data-level="5.9" data-path="ch5.html"><a href="ch5.html#more-summarize"><i class="fa fa-check"></i><b>5.9</b> More <code>summarize()</code></a></li>
<li class="chapter" data-level="5.10" data-path="ch5.html"><a href="ch5.html#fit-the-model"><i class="fa fa-check"></i><b>5.10</b> Fit the Model</a></li>
<li class="chapter" data-level="" data-path="ch5.html"><a href="ch5.html#exercise-5"><i class="fa fa-check"></i>Exercise 5</a><ul>
<li class="chapter" data-level="" data-path="ch5.html"><a href="ch5.html#exercise-5-bonus"><i class="fa fa-check"></i>Exercise 5 Bonus</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="6" data-path="ch6.html"><a href="ch6.html"><i class="fa fa-check"></i><b>6</b> Mapping and Spatial Analysis</a><ul>
<li class="chapter" data-level="6.1" data-path="ch6.html"><a href="ch6.html#ch6overview"><i class="fa fa-check"></i><b>6.1</b> Chapter Overview</a></li>
<li class="chapter" data-level="6.2" data-path="ch6.html"><a href="ch6.html#ch6beforeyoubegin"><i class="fa fa-check"></i><b>6.2</b> Before You Begin</a></li>
<li class="chapter" data-level="6.3" data-path="ch6.html"><a href="ch6.html#intro"><i class="fa fa-check"></i><b>6.3</b> Geospatial Data</a></li>
<li class="chapter" data-level="6.4" data-path="ch6.html"><a href="ch6.html#Import"><i class="fa fa-check"></i><b>6.4</b> Importing Geospatial Data</a></li>
<li class="chapter" data-level="6.5" data-path="ch6.html"><a href="ch6.html#SpatPlot"><i class="fa fa-check"></i><b>6.5</b> Plotting</a><ul>
<li class="chapter" data-level="6.5.1" data-path="ch6.html"><a href="ch6.html#zoom"><i class="fa fa-check"></i><b>6.5.1</b> Zooming</a></li>
<li class="chapter" data-level="6.5.2" data-path="ch6.html"><a href="ch6.html#plotting-selections"><i class="fa fa-check"></i><b>6.5.2</b> Plotting Selections</a></li>
</ul></li>
<li class="chapter" data-level="6.6" data-path="ch6.html"><a href="ch6.html#ManipSpat"><i class="fa fa-check"></i><b>6.6</b> Manipulating Spatial Data</a><ul>
<li class="chapter" data-level="6.6.1" data-path="ch6.html"><a href="ch6.html#crs"><i class="fa fa-check"></i><b>6.6.1</b> Changing the CRS</a></li>
<li class="chapter" data-level="6.6.2" data-path="ch6.html"><a href="ch6.html#clip"><i class="fa fa-check"></i><b>6.6.2</b> Clipping</a></li>
<li class="chapter" data-level="6.6.3" data-path="ch6.html"><a href="ch6.html#adding-attributes"><i class="fa fa-check"></i><b>6.6.3</b> Adding Attributes</a></li>
</ul></li>
<li class="chapter" data-level="6.7" data-path="ch6.html"><a href="ch6.html#Anal"><i class="fa fa-check"></i><b>6.7</b> Analysis</a><ul>
<li class="chapter" data-level="6.7.1" data-path="ch6.html"><a href="ch6.html#home-range-analysis-6.5.1"><i class="fa fa-check"></i><b>6.7.1</b> 6.5.1 Home Range Analysis {###6.5.1}</a></li>
<li class="chapter" data-level="6.7.2" data-path="ch6.html"><a href="ch6.html#finding-intersections-between-two-layers"><i class="fa fa-check"></i><b>6.7.2</b> 6.5.2 Finding Intersections Between Two Layers</a></li>
</ul></li>
<li class="chapter" data-level="6.8" data-path="ch6.html"><a href="ch6.html#PresentMap"><i class="fa fa-check"></i><b>6.8</b> Creating a Presentable Map</a></li>
<li class="chapter" data-level="6.9" data-path="ch6.html"><a href="ch6.html#Exercise_6"><i class="fa fa-check"></i><b>6.9</b> EXERCISE</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="exercise-solutions.html"><a href="exercise-solutions.html"><i class="fa fa-check"></i>Exercise Solutions</a><ul>
<li class="chapter" data-level="" data-path="exercise-solutions.html"><a href="exercise-solutions.html#ex1a-answers"><i class="fa fa-check"></i>Exercise 1A Solutions</a></li>
<li class="chapter" data-level="" data-path="exercise-solutions.html"><a href="exercise-solutions.html#ex1b-answers"><i class="fa fa-check"></i>Exercise 1B Solutions</a></li>
<li class="chapter" data-level="" data-path="exercise-solutions.html"><a href="exercise-solutions.html#ex2-answers"><i class="fa fa-check"></i>Exercise 2 Solutions</a></li>
<li class="chapter" data-level="" data-path="exercise-solutions.html"><a href="exercise-solutions.html#ex3-answers"><i class="fa fa-check"></i>Exercise 3 Solutions</a></li>
<li class="chapter" data-level="" data-path="exercise-solutions.html"><a href="exercise-solutions.html#ex4a-answers"><i class="fa fa-check"></i>Exercise 4A Solutions</a></li>
<li class="chapter" data-level="" data-path="exercise-solutions.html"><a href="exercise-solutions.html#ex4b-answers"><i class="fa fa-check"></i>Exercise 4B Solutions</a></li>
<li class="chapter" data-level="" data-path="exercise-solutions.html"><a href="exercise-solutions.html#ex4c-answers"><i class="fa fa-check"></i>Exercise 4C Solutions</a></li>
<li class="chapter" data-level="" data-path="exercise-solutions.html"><a href="exercise-solutions.html#ex4d-answers"><i class="fa fa-check"></i>Exercise 4D Solutions</a></li>
<li class="chapter" data-level="" data-path="exercise-solutions.html"><a href="exercise-solutions.html#ex4e-answers"><i class="fa fa-check"></i>Exercise 4E Solutions</a></li>
<li class="chapter" data-level="" data-path="exercise-solutions.html"><a href="exercise-solutions.html#ex4f-answers"><i class="fa fa-check"></i>Exercise 4F Solutions</a></li>
<li class="chapter" data-level="" data-path="exercise-solutions.html"><a href="exercise-solutions.html#ex5-answers"><i class="fa fa-check"></i>Exercise 5 Solutions</a></li>
<li class="chapter" data-level="" data-path="exercise-solutions.html"><a href="exercise-solutions.html#ex6-answers"><i class="fa fa-check"></i>Exercise 6 Solutions</a></li>
</ul></li>
<li class="divider"></li>
<li><a href="https://github.com/bstaton1/au-r-workshop-data" target="blank">Get the Data</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Introduction to R for Natural Resource Scientists</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="ch6" class="section level1">
<h1><span class="header-section-number">Chapter 6</span> Mapping and Spatial Analysis</h1>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">rm</span>(<span class="dt">list =</span> <span class="kw">ls</span>(<span class="dt">all =</span> T))
knitr<span class="op">::</span>opts_chunk<span class="op">$</span><span class="kw">set</span>(<span class="dt">fig.align =</span> <span class="st">&quot;center&quot;</span>, <span class="dt">message =</span> F, <span class="dt">warning =</span> F)</code></pre></div>
<div id="ch6overview" class="section level2">
<h2><span class="header-section-number">6.1</span> Chapter Overview</h2>
<p>R is a relatively under-used tool for creating Geographic Information Systems. Most people use ArcGIS, QGIS, or Google Earth to display and analyze spatial data. However, R can do just about anything you might want to do in those programs, with the added benefit of allowing you to create a reproducible script file to share. Often times, workflows are difficult to replicate in GIS because of the point-click user interface. With R, anyone can replicate your geospatial analysis with your script file and data.</p>
<p>In this chapter, you will learn the basics of:</p>
<ul>
<li>creating a GIS in R</li>
<li>mapping parts of your GIS</li>
<li>“selecting by attribute” (A.K.A.<code>subset()</code> or <code>dplyr::filter()</code> in R)</li>
<li>manipulating spatial objects</li>
</ul>
<p>You will map and analyze data from a study tracking brown bear (<em>Ursus arctos</em>) movements <span class="citation">(Kaczensky <a href="#ref-bears-cite">1999</a>)</span>. In Slovenia, a railroad connects the capitol Ljubljana with the coastal city of Koper, and passes right through brown bear country. You will use R to assess potential sites to build a hypothetical wildlife overpass so that bears can safely cross the railroad.</p>
<p>It is worth mentioning that if you are left wanting more geospatial analysis in R after this brief introduction, a much more thorough and dedicated description is presented for free in <span class="citation">Lovelace, Nowosad, and Muenchow (<a href="#ref-geospatR-cite">2018</a>)</span>.</p>
</div>
<div id="ch6beforeyoubegin" class="section level2">
<h2><span class="header-section-number">6.2</span> Before You Begin</h2>
<p>You should create a new directory and R script for your work in this chapter called <code>Ch6.R</code> and save it in the directory <code>C:/Users/YOU/Documents/R-Book/Chapter6</code>. Set your working directory to that location. Revisit the material in Sections <a href="ch1.html#scripts">1.2</a> and <a href="ch1.html#working-dir">1.3</a> for more details on these steps.</p>
<p>For this chapter, it will be helpful to have the data in your working directory. In the <code>Data/Ch6</code> folder (see the <a href="index.html#data-sets">instructions</a> on acquiring the data files), you’ll find:</p>
<ol style="list-style-type: decimal">
<li>a file named <code>bear.csv</code>,</li>
<li>folders named <code>railways</code>, <code>states</code>, and <code>SVN_adm</code>, and</li>
<li>an R script called <code>points_to_line.R</code>.</li>
</ol>
<p>Copy (or cut if you’d like) all of these files/folders from <code>Data/Ch6</code> into your working directory.</p>
<p>Mapping in R requires many packages. Install <strong>all</strong> of the following packages:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">install.packages</span>(
  <span class="kw">c</span>(<span class="st">&quot;sp&quot;</span>,<span class="st">&quot;rgdal&quot;</span>,<span class="st">&quot;maptools&quot;</span>,
  <span class="st">&quot;rgeos&quot;</span>,<span class="st">&quot;raster&quot;</span>,<span class="st">&quot;scales&quot;</span>,
  <span class="st">&quot;adehabitatHR&quot;</span>,<span class="st">&quot;dismo&quot;</span>)
)</code></pre></div>
<p>You will need <code>{dplyr}</code> as well, if you did not install it already for Chapter <a href="ch5.html#ch5">5</a>.</p>
<p>Rather than load all the packages at the top of the script (as is typically customary), this chapter will load and briefly describe each package immediately prior to using it for the first time.</p>
</div>
<div id="intro" class="section level2">
<h2><span class="header-section-number">6.3</span> Geospatial Data</h2>
<p>There are two types of geospatial data: <strong>vector</strong> and <strong>raster</strong> data. R is able to handle both, but for the sake of simplicity, this chapter will mostly deal with vector data. There are three types of vector data that you should be familiar with (Figure <a href="ch6.html#fig:vector-types">6.1</a>):</p>
<ul>
<li>A <strong>point</strong> is a pair of coordinates (x = longitude, y = latitude) that represent the location of some observed object or event</li>
<li>A <strong>line</strong> is a path between two or more ordered points. The endpoints of a line are called <strong>vertices</strong>.</li>
<li>A <strong>polygon</strong> is an area bounded by vertices that are connected in order. In a polygon, the first and last vertex are the same. In this first section, you will learn how to load these different types of data and create spatial objects that you can manipulate and visualize in R.</li>
</ul>
<div class="figure" style="text-align: center"><span id="fig:vector-types"></span>
<img src="au-r-workshop_files/figure-html/vector-types-1.png" alt="The three basic types of GIS vector data" width="864" />
<p class="caption">
Figure 6.1: The three basic types of GIS vector data
</p>
</div>
</div>
<div id="Import" class="section level2">
<h2><span class="header-section-number">6.4</span> Importing Geospatial Data</h2>
<p>Begin by loading in coordinate data from <code>bears.csv</code> and creating a points layer from them. The points are from a telemetry study that tracked brown bear movements in south western Slovenia for a period of about 10 years <span class="citation">(Kaczensky <a href="#ref-bears-cite">1999</a>)</span>. Each observation in this data set represents what is called a <strong>relocation event</strong> - meaning a bear was detected again after it was initially tagged. The variables measured at each relocation event include a location, a time, and several other variables.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">bear =<span class="st"> </span><span class="kw">read.csv</span>(<span class="st">&quot;bear.csv&quot;</span>,<span class="dt">stringsAsFactors =</span> F)
<span class="kw">colnames</span>(bear)</code></pre></div>
<pre><code>##  [1] &quot;event.id&quot;                        &quot;visible&quot;                        
##  [3] &quot;timestamp&quot;                       &quot;location.long&quot;                  
##  [5] &quot;location.lat&quot;                    &quot;behavioural.classification&quot;     
##  [7] &quot;comments&quot;                        &quot;location.error.text&quot;            
##  [9] &quot;sensor.type&quot;                     &quot;individual.taxon.canonical.name&quot;
## [11] &quot;tag.local.identifier&quot;            &quot;individual.local.identifier&quot;    
## [13] &quot;study.name&quot;                      &quot;utm.easting&quot;                    
## [15] &quot;utm.northing&quot;                    &quot;utm.zone&quot;</code></pre>
<p>There are quite a few variables in these data that are extraneous, so just keep the bare necessities: the date and time a bear was relocated, the name of the observed bear, and the x and y coordinates of its relocation. Also, omit the observations that have an <code>NA</code> value for any of those variables with <code>na.omit()</code>:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">bear =<span class="st"> </span><span class="kw">na.omit</span>(bear[,<span class="kw">c</span>(<span class="st">&quot;timestamp&quot;</span>,<span class="st">&quot;tag.local.identifier&quot;</span>,
                        <span class="st">&quot;location.long&quot;</span>,<span class="st">&quot;location.lat&quot;</span>)])
<span class="kw">colnames</span>(bear) =<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;timestamp&quot;</span>,<span class="st">&quot;ID&quot;</span>,<span class="st">&quot;x&quot;</span>,<span class="st">&quot;y&quot;</span>)
<span class="kw">head</span>(bear)</code></pre></div>
<pre><code>##             timestamp    ID        x        y
## 1 1994-04-23 22-00-00 ancka 14.32837 45.88914
## 2 1994-04-24 16-40-00 ancka 14.37175 45.87072
## 3 1994-04-25 14-45-00 ancka 14.39852 45.86659
## 4 1994-04-26 12-30-00 ancka 14.41215 45.88695
## 5 1994-04-28 12-00-00 ancka 14.41260 45.87476
## 6 1994-04-29 09-30-00 ancka 14.40471 45.88957</code></pre>
<p>Notice that the bears have names: <code>unique(bear$ID)</code>. Do some more simple data wrangling:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># how many records of each bear are there?</span>
<span class="kw">table</span>(bear<span class="op">$</span>ID)</code></pre></div>
<pre><code>## 
##  ancka   clio  dinko  dusan   ivan   jana  janko   joze   jure klemen 
##    351     20     11     43      7    111      7     24     17     19 
##  lucia   maja  metka  milan mishko   nejc polona srecko  urosh  vanja 
##    169    247     66      3    129    117    208    138     21     65 
##   vera  vinko 
##     92     33</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># bears that were relocated fewer than 5 times </span>
<span class="co"># cannot be used in future analysis so filter them out</span>
<span class="kw">library</span>(dplyr)
bear =<span class="st"> </span>bear <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">group_by</span>(ID) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">filter</span>(<span class="kw">n</span>() <span class="op">&gt;=</span><span class="st"> </span><span class="dv">5</span>)

<span class="co"># now how many bears are there?</span>
<span class="kw">unique</span>(bear<span class="op">$</span>ID)</code></pre></div>
<pre><code>##  [1] &quot;ancka&quot;  &quot;clio&quot;   &quot;dinko&quot;  &quot;dusan&quot;  &quot;ivan&quot;   &quot;jana&quot;   &quot;janko&quot; 
##  [8] &quot;joze&quot;   &quot;jure&quot;   &quot;klemen&quot; &quot;lucia&quot;  &quot;maja&quot;   &quot;metka&quot;  &quot;mishko&quot;
## [15] &quot;nejc&quot;   &quot;polona&quot; &quot;srecko&quot; &quot;urosh&quot;  &quot;vanja&quot;  &quot;vera&quot;   &quot;vinko&quot;</code></pre>
<p>Now, use the <code>{sp}</code> package to create a spatial object out of your standard R data frame. You can think of this object like a <strong>layer</strong> in GIS. <code>{sp}</code> lets you create layers with or without attribute tables, but if your spatial data have other attributes like an ID or a timestamp variable, you should always create an object with class <code>SpatialPointsDataFrame</code> to make sure those variables/attributes are stored.</p>
<p>In order to convert a data frame into a <code>SpatialPointsDataFrame</code>, you need to specify four arguments:</p>
<ul>
<li><code>data</code>: the data frame being converted,</li>
<li><code>coords</code>: the coordinates in that dataframe,</li>
<li><code>coords.nrs</code>: the indices for those coordinate vectors in the <code>data</code> data.frame, and</li>
<li><code>proj4string</code>: the projected coordinate system of the data. You will use the WGS84 coordinate reference system. More on coordinate reference systems later in Section <a href="ch6.html#crs">6.6.1</a><a href="#fn1" class="footnoteRef" id="fnref1"><sup>1</sup></a>.</li>
</ul>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(sp)
bear =<span class="st"> </span><span class="kw">SpatialPointsDataFrame</span>(
  <span class="dt">data =</span> bear,
  <span class="dt">coords =</span> bear[,<span class="kw">c</span>(<span class="st">&quot;x&quot;</span>,<span class="st">&quot;y&quot;</span>)],
  <span class="dt">coords.nrs =</span> <span class="kw">c</span>(<span class="dv">3</span>,<span class="dv">4</span>),
  <span class="dt">proj4string =</span> <span class="kw">CRS</span>(<span class="st">&quot;+init=epsg:4326&quot;</span>)
  )</code></pre></div>
<p>Without any reference data these points are essentially useless. You will need to load some more spatial data to get your bearings. The <code>{rgdal}</code> package facilitates loading spatial data files (i.e., shapefiles) into R. The function <code>readOGR()</code> takes a standard shapefile (<code>.shp</code>), converts it into a spatial object, and automatically knows whether it’s a points, lines, or polygons layer. It takes two arguments: the data source name (<code>dsn</code>, the directory), and the layer name (<code>layer</code>). When you download a shapefile from an open-source web portal, it will often have accompanying files that store the attribute data. Store all of these files in a folder with the same name as the shapefile. Now load in the shapefiles from the directory, so you can see where the brown bears were detected:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co">#load all the shapefiles for the background map. </span>
<span class="co">#you&#39;ll learn how to add a basemap later</span>
<span class="kw">library</span>(rgdal)
<span class="co">#border of slovenia</span>
slovenia =<span class="st"> </span><span class="kw">readOGR</span>(<span class="dt">dsn=</span><span class="st">&quot;./SVN_adm&quot;</span>,<span class="dt">layer=</span><span class="st">&quot;SVN_adm0&quot;</span>)</code></pre></div>
<p>There are two important differences between <code>readOGR()</code> and <code>read.csv()</code>:</p>
<ol style="list-style-type: decimal">
<li>The directory shortening syntax is not the same. Notice the period in the data source names. This indicates your working directory.</li>
<li>When calling the layer name, the file extension <code>.shp</code> is not required.</li>
</ol>
<p>Notice the feature class of <code>slovenia</code> is a polygon:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">class</span>(slovenia)</code></pre></div>
<pre><code>## [1] &quot;SpatialPolygonsDataFrame&quot;
## attr(,&quot;package&quot;)
## [1] &quot;sp&quot;</code></pre>
<p>Now read in the remaining two shapefiles:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co">#major railroads in slovenia</span>
railways =<span class="st"> </span><span class="kw">readOGR</span>(<span class="dt">dsn =</span> <span class="st">&quot;./railways&quot;</span>,
                   <span class="dt">layer =</span> <span class="st">&quot;railways&quot;</span>) 
<span class="co">#statistical areas (states)</span>
stats =<span class="st"> </span><span class="kw">readOGR</span>(<span class="dt">dsn =</span> <span class="st">&quot;./SVN_adm&quot;</span>,
                <span class="dt">layer =</span> <span class="st">&quot;SVN_adm1&quot;</span>, <span class="dt">stringsAsFactors =</span> F)  </code></pre></div>
</div>
<div id="SpatPlot" class="section level2">
<h2><span class="header-section-number">6.5</span> Plotting</h2>
<p>Plotting spatial objects in R is a breeze. See what happens if you just plot the <code>bear</code> object:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">plot</span>(bear)</code></pre></div>
<p>You can clean up your map a bit with many of the standard <code>{graphics}</code> arguments:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(scales)
<span class="kw">plot</span>(bear, <span class="dt">col =</span> <span class="kw">alpha</span>(<span class="st">&quot;grey&quot;</span>, <span class="fl">0.5</span>), <span class="dt">pch =</span> <span class="dv">16</span>, <span class="dt">axes =</span> T)</code></pre></div>
<p><img src="au-r-workshop_files/figure-html/unnamed-chunk-15-1.png" width="480" style="display: block; margin: auto;" /></p>
<p>The <code>alpha()</code> function from the <code>{scales}</code> package allows you to plot with transparent colors, which is helpful for seeing the high- versus low-density clusters. Now, plot your reference layers to get your bearings:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co">#make a map of all the bear relocations and railways in slovenia</span>
<span class="kw">plot</span>(stats, <span class="dt">border =</span> <span class="st">&quot;grey&quot;</span>, <span class="dt">axes =</span> T)
<span class="kw">plot</span>(slovenia, <span class="dt">lwd =</span> <span class="dv">3</span>, <span class="dt">add =</span> T)
<span class="kw">plot</span>(railways, <span class="dt">add =</span> T, <span class="dt">col =</span> <span class="st">&quot;red&quot;</span>, <span class="dt">lwd =</span> <span class="dv">3</span>)
<span class="kw">points</span>(bear, <span class="dt">pch =</span> <span class="dv">16</span>, <span class="dt">cex =</span> <span class="fl">0.5</span>, <span class="dt">col =</span> <span class="kw">alpha</span>(<span class="st">&quot;blue&quot;</span>, <span class="fl">0.5</span>))</code></pre></div>
<p><img src="au-r-workshop_files/figure-html/unnamed-chunk-17-1.png" width="480" style="display: block; margin: auto;" /></p>
<div id="zoom" class="section level3">
<h3><span class="header-section-number">6.5.1</span> Zooming</h3>
<p>You may want to zoom in on the part of Slovenia where the bears are. Spatial objects in R have a slot<a href="#fn2" class="footnoteRef" id="fnref2"><sup>2</sup></a> called <code>bbox</code> which is the “boundary box” of the data in that object. You can use the <code>bbox</code> to specify what <code>xlim</code> and <code>ylim</code> should be:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">plot</span>(stats, <span class="dt">border =</span> <span class="st">&quot;grey&quot;</span>, <span class="dt">axes =</span> T,
     <span class="dt">xlim =</span> bear<span class="op">@</span>bbox[<span class="dv">1</span>,],  <span class="co"># access the boundary box using @</span>
     <span class="dt">ylim =</span> bear<span class="op">@</span>bbox[<span class="dv">2</span>,])
<span class="kw">plot</span>(slovenia, <span class="dt">lwd =</span> <span class="dv">3</span>, <span class="dt">add =</span> T)
<span class="kw">points</span>(bear, <span class="dt">pch =</span> <span class="dv">16</span>, <span class="dt">cex =</span> <span class="fl">0.5</span>, <span class="dt">col =</span> <span class="kw">alpha</span>(<span class="st">&quot;blue&quot;</span>, <span class="fl">0.5</span>))
<span class="kw">plot</span>(railways, <span class="dt">add =</span> T, <span class="dt">col =</span> <span class="st">&quot;red&quot;</span>, <span class="dt">lwd =</span> <span class="dv">3</span>)</code></pre></div>
<p><img src="au-r-workshop_files/figure-html/unnamed-chunk-19-1.png" width="480" style="display: block; margin: auto;" /></p>
</div>
<div id="plotting-selections" class="section level3">
<h3><span class="header-section-number">6.5.2</span> Plotting Selections</h3>
<p>In GIS, a subset is often called a <strong>selection</strong>: it is a smaller subset of your larger data layers. You may want to see the relocation events for each individual bear at a time. Use <code>sapply()</code> to apply a function to each bear’s detected movement trajectory them separately. Wrap your code inside of a new PDF device (Section ) <a href="ch2.html#file-devices">2.10.2</a>) so you can scroll through the plots separately:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">pdf</span>(<span class="st">&quot;Relocations.pdf&quot;</span>, <span class="dt">h =</span> <span class="dv">5</span>, <span class="dt">w =</span> <span class="dv">5</span>)
<span class="kw">sapply</span>(<span class="kw">unique</span>(bear<span class="op">$</span>ID), <span class="cf">function</span>(id) {
  <span class="kw">par</span>(<span class="dt">mar =</span> <span class="kw">c</span>(<span class="dv">2</span>,<span class="dv">2</span>,<span class="dv">1</span>,<span class="dv">1</span>))
  <span class="kw">plot</span>(stats, <span class="dt">border =</span> <span class="st">&quot;grey&quot;</span>, <span class="dt">axes =</span> T,
       <span class="dt">xlim =</span> bear<span class="op">@</span>bbox[<span class="dv">1</span>,],  <span class="co"># access the boundary box using @</span>
       <span class="dt">ylim =</span> bear<span class="op">@</span>bbox[<span class="dv">2</span>,], <span class="dt">main =</span> <span class="kw">paste</span>(<span class="st">&quot;Bear:&quot;</span>, id))
  <span class="kw">plot</span>(slovenia, <span class="dt">lwd =</span> <span class="dv">3</span>, <span class="dt">add =</span> T)
  <span class="kw">points</span>(bear[bear<span class="op">$</span>ID <span class="op">==</span><span class="st"> </span>id,], <span class="dt">type =</span> <span class="st">&quot;o&quot;</span>, <span class="dt">pch =</span> <span class="dv">16</span>, <span class="dt">cex =</span> <span class="fl">0.5</span>, <span class="dt">col =</span> <span class="kw">alpha</span>(<span class="st">&quot;blue&quot;</span>, <span class="fl">0.5</span>))
  <span class="kw">plot</span>(railways, <span class="dt">add =</span> T, <span class="dt">col =</span> <span class="st">&quot;red&quot;</span>, <span class="dt">lwd =</span> <span class="dv">3</span>)
})
<span class="kw">dev.off</span>()</code></pre></div>
<p>When you run this code, it will look like nothing happened. Go to your working directory and open the newly created file <code>Relocations.pdf</code> to see the output. Note that if you want to make changes to the PDF file by running <code>pdf(...); plot(...)</code>, you’ll need to close the file in your PDF viewer beforehand<a href="#fn3" class="footnoteRef" id="fnref3"><sup>3</sup></a>.</p>
</div>
</div>
<div id="ManipSpat" class="section level2">
<h2><span class="header-section-number">6.6</span> Manipulating Spatial Data</h2>
<p>Now that you have some data and you’ve taken a look at it, it’s time to learn a few tricks for manipulating those data. Looking at your map, see that some of the bears were detected outside of Slovenia. (Bonus points if you can name the country they’re in). Suppose the Slovenian government can’t build wildlife crossings in other countries, so you want to clip the bear data to the extent of Slovenia.</p>
<div id="crs" class="section level3">
<h3><span class="header-section-number">6.6.1</span> Changing the CRS</h3>
<p>Before you can manipulate any two related layers (e.g., clipping), you have to ensure that the two layers have identical coordinate systems. This can be done easily with the <code>spTransform()</code> function in the <code>{sp}</code> package. In order to obtain the coordinate reference system of a spatial object like <code>bear</code>, all you have to do is call <code>proj4string(bear)</code>. You can pass this directly to <code>spTransform()</code> like this:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">slovenia =<span class="st"> </span><span class="kw">spTransform</span>(slovenia, <span class="kw">CRS</span>(<span class="kw">proj4string</span>(bear))) </code></pre></div>
</div>
<div id="clip" class="section level3">
<h3><span class="header-section-number">6.6.2</span> Clipping</h3>
<p>Clipping is as simple as a standard subset in R. You can select the relocations that occured only in Slovenia using:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">bear =<span class="st"> </span>bear[slovenia,]</code></pre></div>
<p>Make the same plot as you did in Section <a href="ch6.html#zoom">6.5.1</a></p>
<p><img src="au-r-workshop_files/figure-html/unnamed-chunk-23-1.png" width="480" style="display: block; margin: auto;" /></p>
</div>
<div id="adding-attributes" class="section level3">
<h3><span class="header-section-number">6.6.3</span> Adding Attributes</h3>
<p>What if you wanted to add an attribute to a points object, like which polygon it occurs in? In order to figure out how many bear relocations were documented in each statistical region of Slovenia, you’ll have to merge the two objects.</p>
</div>
</div>
<div id="Anal" class="section level2">
<h2><span class="header-section-number">6.7</span> Analysis</h2>
<p>Now that you know how to import, plot, and manipulate your data, it’s time to do some analysis. {rgeos} has a few tools for simple geometric calculations like finding the distance between two points, or the area of a polygon. However, more specialized analyses are often only available in other packages. One commonly used package in animal ecology is the {adehabitat} package suite. Use this package in conjunction with {rgeos} to determine where the tagged bears may have crossed the railroad.</p>
<div id="home-range-analysis-6.5.1" class="section level3">
<h3><span class="header-section-number">6.7.1</span> 6.5.1 Home Range Analysis {###6.5.1}</h3>
<p>If you look at the plots in Section @ref(6.3.2), it looks like some bears live very close to the railroad, but do not cross it, some live very far away, and others may have crossed it multiple times. Which bears’ home ranges are intersected by the railroad? In order to determine this, you will have to calculate the home range of each animal with the <code>mcp</code> function in the {adehabitat} package.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(adehabitatHR) <span class="co">#load the adehabitat home range calculation package. there are 5 different ways you can calculate the homerange of an animal, but mcp is the most common way.</span>
bear &lt;-<span class="st"> </span><span class="kw">spTransform</span>(bear,<span class="kw">CRS</span>(<span class="st">&quot;+proj=utm +north +zone=33 +ellps=WGS84&quot;</span>)) <span class="co">#the mcp function requires coordinates be in the Universal Transverse Mercator system</span>
cp &lt;-<span class="st"> </span><span class="kw">mcp</span>(<span class="dt">xy=</span>bear[,<span class="dv">2</span>], <span class="dt">percent=</span><span class="dv">95</span>,<span class="dt">unin=</span><span class="st">&quot;m&quot;</span>,<span class="dt">unout=</span><span class="st">&quot;km2&quot;</span>) </code></pre></div>
<p><code>mcp</code> calculates the minimum convex polygon bounded by the extent of the points which are within some percentile of closeness to the centroid of a group. Points that are very far away from the center are excluded. The standard percentile is 95%. <code>mcp</code> requires three other arguments: the grouping variable of the spatial points data frame, the units of the input, and the units of the output. (UTM is always in meters, and so is the <code>mcp</code> default). If you run <code>cp</code>, you’ll see that the areas of each polygon are stored in the object in kilometers squared.</p>
<p>Now, plot the homeranges of each bear, label them, and overlay the railroad on a map.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(scales) <span class="co">#scales has a nice feature called alpha that allows you to change the transparency of colors in plots</span>
<span class="kw">library</span>(rgeos) <span class="co">#rgeos has a few nice functions for plotting and spatial transformations</span>

<span class="co">#match the coordinate system of the home ranges object with the railways layer </span>
cp &lt;-<span class="st"> </span><span class="kw">spTransform</span>(cp, <span class="kw">CRS</span>(<span class="st">&quot;+init=epsg:4326&quot;</span>)) 
railways&lt;-<span class="st"> </span><span class="kw">spTransform</span>(railways,<span class="kw">CRS</span>(<span class="st">&quot;+init=epsg:4326&quot;</span>))
cp &lt;-<span class="st"> </span>cp[railways,] <span class="co">#select only the homeranges that include some part of the railway</span>

<span class="kw">plot</span>(cp,<span class="dt">col=</span><span class="kw">alpha</span>(<span class="st">&#39;blue&#39;</span>,.<span class="dv">4</span>))
  <span class="kw">polygonsLabel</span>(cp,<span class="dt">labels=</span>cp<span class="op">$</span>id,<span class="dt">method=</span><span class="st">&quot;buffer&quot;</span>,<span class="dt">col=</span><span class="st">&quot;white&quot;</span>,<span class="dt">doPlot=</span>T) <span class="co">#rgeos has a bunch of neat functions like this one</span>
  <span class="kw">lines</span>(railways,<span class="dt">lwd=</span><span class="dv">3</span>,<span class="dt">col=</span><span class="st">&quot;red&quot;</span>) <span class="co">#overlay the railway</span>
  <span class="kw">box</span>()</code></pre></div>
</div>
<div id="finding-intersections-between-two-layers" class="section level3">
<h3><span class="header-section-number">6.7.2</span> 6.5.2 Finding Intersections Between Two Layers</h3>
<p>Now that you know which bears crossed the railroad, find out where. You’ll need a home-made function called <code>points_to_line</code> which is stored as a script file in your directory. If you ever write a function, you can store it in a script file, and then call on it with the <code>source</code> function instead of copying and pasting all that code every time you want to use it in a new script. Save as many functions as you want in a single script, and they will all be added to your Global Environment when you source the file.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(maptools) <span class="co">#you&#39;ll need this package to run the next home-made function</span>
<span class="kw">source</span>(<span class="st">&quot;points_to_line.R&quot;</span>) <span class="co">#load the home-made function from the directory </span>
bear &lt;-<span class="st"> </span><span class="kw">spTransform</span>(bear, <span class="kw">CRS</span>(<span class="st">&quot;+init=epsg:4326&quot;</span>))

<span class="co">#turn the bear relocations into tracks</span>
bearlines&lt;-<span class="kw">points_to_line</span>(<span class="kw">as.data.frame</span>(bear),<span class="dt">long=</span><span class="st">&quot;x&quot;</span>,<span class="dt">lat=</span><span class="st">&quot;y&quot;</span>,<span class="dt">id_field=</span><span class="st">&quot;ID&quot;</span>,<span class="dt">sort_field =</span> <span class="st">&quot;timestamp&quot;</span>)

<span class="co">#find where those tracks intersect the railroad, and make a points layer with all the intersection points</span>
start &lt;-<span class="st"> </span><span class="kw">Sys.time</span>()
crossings &lt;-<span class="st"> </span><span class="kw">gIntersection</span>(bearlines,railways) 
<span class="kw">Sys.time</span>()<span class="op">-</span>start
<span class="co">#run all three lines at the same time to get a measurement of how long it takes. this should take about 8 minutes to run so sit tight.</span></code></pre></div>
</div>
</div>
<div id="PresentMap" class="section level2">
<h2><span class="header-section-number">6.8</span> Creating a Presentable Map</h2>
<p>Now that you have a points object with the crossings stored, make a map that you can present to policy makers.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(dismo)
<span class="kw">library</span>(raster) <span class="co">#the basemap will be stored as a raster object.</span>
basemap &lt;-<span class="st"> </span><span class="kw">gmap</span>(bear,<span class="dt">exp=</span><span class="dv">1</span>,<span class="dt">type=</span><span class="st">&quot;terrain&quot;</span>,<span class="dt">lonlat =</span> T)
<span class="kw">plot</span>(basemap)
<span class="co">#reproject each layer to the coordinate system of the basemap.</span>
bear &lt;-<span class="st"> </span><span class="kw">spTransform</span>(bear, basemap<span class="op">@</span>crs)
railways &lt;-<span class="st"> </span><span class="kw">spTransform</span>(railways, basemap<span class="op">@</span>crs)
slovenia &lt;-<span class="st"> </span><span class="kw">spTransform</span>(slovenia, basemap<span class="op">@</span>crs)
<span class="kw">proj4string</span>(crossings) &lt;-<span class="st"> </span>basemap<span class="op">@</span>crs
<span class="kw">points</span>(bear,<span class="dt">col=</span><span class="st">&quot;white&quot;</span>,<span class="dt">pch=</span><span class="dv">15</span>,<span class="dt">cex=</span>.<span class="dv">5</span>)
railways &lt;-<span class="st"> </span><span class="kw">crop</span>(railways,basemap)
<span class="kw">plot</span>(railways,<span class="dt">add=</span>T,<span class="dt">lwd=</span><span class="dv">4</span>,<span class="dt">col=</span><span class="st">&quot;yellow&quot;</span>)
<span class="kw">plot</span>(crossings,<span class="dt">add=</span>T,<span class="dt">col=</span><span class="st">&quot;red&quot;</span>,<span class="dt">cex=</span><span class="dv">1</span>,<span class="dt">pch=</span><span class="dv">16</span>)
<span class="kw">box</span>()
<span class="co">#scalebar(5000,xy=click(),col=&quot;white&quot;)</span>
<span class="co">#legend?</span>
<span class="co">#labels?</span>
<span class="co">#arrows?</span></code></pre></div>
<p>Where are bears crossing the railroad? It looks like there are two areas of the railroad that get the most bear activity. add arrows pointing to where you think the crossings should go.</p>
</div>
<div id="Exercise_6" class="section level2">
<h2><span class="header-section-number">6.9</span> EXERCISE</h2>
<ol style="list-style-type: decimal">
<li>Load the cave shapefile from the directory. Add the data to the map.</li>
<li>How many caves are there?</li>
<li>How many caves are in each statistical area?</li>
<li>Which bear has the most caves in its homerange?</li>
<li>Bonus: use the</li>
</ol>

</div>
</div>
<h3>References</h3>
<div id="refs" class="references">
<div id="ref-bears-cite">
<p>Kaczensky, Knauer, P. 1999. “SLovenian Brown Bear 1993-1999 Telemetry Data Set.” <a href="https://www.movebank.org/panel_embedded_movebank_webapp?destination=panel_embedded_movebank_webapp" class="uri">https://www.movebank.org/panel_embedded_movebank_webapp?destination=panel_embedded_movebank_webapp</a>.</p>
</div>
<div id="ref-geospatR-cite">
<p>Lovelace, R., J. Nowosad, and J. Muenchow. 2018. <em>Geocomputation with R</em>. 1st ed. Boca Raton, Florida: Chapman; Hall/CRC. <a href="https://geocompr.robinlovelace.net/" class="uri">https://geocompr.robinlovelace.net/</a>.</p>
</div>
</div>
<div class="footnotes">
<hr />
<ol start="1">
<li id="fn1"><p>For more information on projected coordinate systems, follow this link: <a href="http://desktop.arcgis.com/en/arcmap/10.3/guide-books/map-projections/about-projected-coordinate-systems.htm" class="uri">http://desktop.arcgis.com/en/arcmap/10.3/guide-books/map-projections/about-projected-coordinate-systems.htm</a><a href="ch6.html#fnref1">↩</a></p></li>
<li id="fn2"><p>slots are components of S4 class objects. more on that here <a href="https://stackoverflow.com/questions/4713968/r-what-are-slots/4714080#4714080" class="uri">https://stackoverflow.com/questions/4713968/r-what-are-slots/4714080#4714080</a><a href="ch6.html#fnref2">↩</a></p></li>
<li id="fn3"><p>This is not true of files created with <code>png()</code> or <code>jpeg()</code><a href="ch6.html#fnref3">↩</a></p></li>
</ol>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="ch5.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="exercise-solutions.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": null,
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"download": ["au-r-workshop.pdf"],
"toc": {
"collapse": "section"
}
});
});
</script>

</body>

</html>
